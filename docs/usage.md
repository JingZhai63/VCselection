<style TYPE="text/css">
code.has-jax {font: inherit; font-size: 100%; background: inherit; border: inherit;}
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'] // removed 'code' entry
    }
});
MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

# Usage
The core function in package _VCselection.jl_ is microVClasso(), which wraps the microbiome data preparation and VC-lasso selection. The usage for microVClasso() is
```julia
microVClasso(Name=Value)
```
Where `Name` is the option name and `Value` is the value of the corresponding option. Note that it's okay if some of the `Value` is not provided since some of the option has a default value.

There are two ways to call _microVClasso()_

* Open up Julia and type
```julia
julia> using VCselection
julia> microVClasso(Name = Value)
```
* From command line, type
```command
$ julia -E 'using VCselection; microVClasso(Name = Value)'
```

# Background
For longitudinal study design, phenotype (outcome variable of interest) and microbiome measurements are collected for a total of $n$ individuals. For each of the individual, they are measured repeatedly at $n_i$ time points. We consider a standard variance components model,

$\bf{y}=\bf{X\beta}+\bf{Zb}+\sum_l^L h_l+\bf{\epsilon}$

$h_l \sim N(\bf{0}, \sigma_{gl}^2\bf{K_l}) $

$\bf{b} \sim  \mathcal{N}(0,\bf{Z}\sigma_d^2\bf{Z}')$

$\bf{\epsilon} \sim \mathcal{N}(0,\sigma_e^2\bf{I}) $

where $\bf{y}$ is a vector of continuous phenotype, $\bf{X}$ is covariate matrix, $\bf{\beta}$ is a vector of fixed effects, $h_l$ is the random effects generated by microbiome taxa $l$ with covariance, $\bf{b}$ is vector of random effects included to control correlation in the repeated measurements, and $\bf{\epsilon}$ is the error term.  It is assumed that $\bf{b}$ and $\bf{h_l}$ are independent with each other. We have variance-covariance structure

$\bf V = \bf  Z\sigma_d^2 \bf Z'+\sum_l^L\sigma_{gl}^2 \bf {K_l} +\sigma_e^2 \bf{I_n}$

Therefore, $\sigma_d^2$, $\sigma_{gl}^2$ and $\sigma_e^2$ are corresponding variance component parameters from correlation, microbiome clusters and environmental effects.

# Specify path for kernel matrices file

Option `Vpath` indicates the folder name (include full path) for the input kernel matrices files.
```julia
microVClasso(Vpath = "/PATH/TO/FOLDER")
```

# Specify input covariates file

Option covFile indicates the file name for the input covariates file. You can always include the full path name for covariates file
```julia
microVClasso(covFile = "covariates.csv",covIdx = [3,4], xhead = true)
```
If option `covFile` is not specified, the covariates matrix **X** will be automatically set to a _n_-by-1 matrix with all elements equal to 1, where n is the number of individuals. The `covIdx` indicates the column number of reading covariates file. The default option `xhead` is true, which indicating the covariates file includes the column name.

# Specify input phenotype file

Option `resFile` indicates the file name for the input phenotype file. `resIdx` indicates the column number of reading phenotype file.
```julia
microVClasso(resFile = "y.csv", resIdx=3)
```


# Specify path for output file

Option `outpath` indicates the /PATH/TO/FOLDER for the output files.
```julia
microVClasso(outpath = "/PATH/OF/FOLDER")
```
If option `outpath` is not specified, the file will be automatically stored at the current directory.

# Specify type of study

Option `longitudinal` indicates the type of study. The default is `false` Typically, a random intercept or random intercept and random slope model is most often used. Now, we simply consider a random intercept model in longitudinal study. If it's a longitudinal microbiome study, then use
```julia
microVClasso(longitudinal = true)
```
If the it's a cross-sectional study, then use the default
```julia
microVClasso(longitudinal = false)
```


# Choose penalty indicates

Option `λfactor` indicates if cluster _l_ will be penalized in variance component model.

In longitudinal study, we do not penalize the block diagonal design matrix Z'Z, we set the `λfactor` to 0 for Z'Z. Therefore, the `λfactor` is a _(L+1)_-by-1 vector with one element equal to 0 for Z'Z, otherwise equal to 1. If `longitudinal` is true and `λfactor` is not provided, the microVClasso will construct the design matrix Z'Z by the subject ID and will set the `λfactor`. If `longitudinal` is true and `λfactor` is provided, the design matrix Z'Z need to be read as the other kernel matrices.

In cross-sectional study, the `λfactor` is a _L_-by-1 vector with all elements equal to 1. The usage is

```julia
microVClasso(λfactor = [1,1,...,1])
```

# Choose selection criterion

Package **VCselection** utilizes two types of criterion AIC or BIC. Option `criterion` indicates which selection criterion you want to perform. The usage is

```julia
microVClasso(criterion = "AIC")
microVClasso(criterion = "BIC")
microVClasso(criterion = "Both")
microVClasso(criterion = "None")

```
The default value for option `criterion` is AIC. If choose "None", the _microVClasso_ will output the estimation for each tuning parameter λ.
